---
title: "Covid91 vaccine study Final2024"
author: "Estefania Maldonado"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))

male = filter(FinalData, sex =="M")
female = filter(FinalData, sex =="F")
lgbtq = filter(FinalData, LGBTQ =="gay")
drugUser = filter(FinalData, DrugUser =="yes")
```


# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

# Methods
Looking at the data collected, this will be categorical explained by categorical statistical problem, we will create separate data variables for each group to separate and test each of them. We will use the candP helper file to use R studios built in bar charts to display data graphically. W will also use xtabs to find the percentages relevant to the data. In this case we are only comparing two types of data and therefore we do not need to use any loops to measure multiple variables in the Fisher test or run a FisherXY.

## Males

### Barplot
```{r}
dd2 <- male %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot represents the population of males and their relationship to getting covid-19 by taking either the vaccine or the placebo. The plot shows that around 68% of males who got covid took the placebo. Whereas about 25% of males who got covid took the vaccine. Therefore, more males who got covid took the placebo, whereas the males who got covid from taking the vaccine were not as likely to contract covid as much. This means that the vaccine seems to be effective for the males in this dataset.There were two plots that came out. The first plot shows two bars for the treatment, either the placebo or the vaccine. Along the x-axis was the amount of people there was, and along the y-axis shows the infected from covid, either placebo or vaccine. It shows the number of people infected from covid or from the placebo.

### Graphical Descriptive Results

```{r}
barchartGC(~infected + treatment,data=male)
barchartGC(~infected + treatment,data=male, type="percent")
```
  
The bar chart above shows the graphical outcomes for males, based on the collected data. It compares the rates of contracting Covid-19 as compared to vaccination status. The left shows people who contracted Covid-19 and the right shows men who have not.

This clearly shows that more than twice the percentage of people who are in the placebo group contracted Covid where people who did not contract Covid are very closely related.

### Numerical Descriptive Results

```{r}
tableMale <- xtabs(~infected + treatment, data=male)
rowPerc(tableMale)
colPerc(tableMale)
```

The set of data illustrates a twofold difference in individuals who received the vaccinations and encountered Covid-19. The placebo group contracted Covid approximately 74% of the time where the vaccinated group contracted Covid 26% of the time. However, there was no significant contrast among those who received vaccinations and were deemed "OK." We can see that the vaccine is generally effective in this testing scenario.


### Inferential Results

```{r}
chisq.test(tableMale)
chisqtestGC(tableMale)
maleFisher <- fisher.test(tableMale)
maleFisher
```

   The Chi Squared test shows that the p-value for males is 0.0000000000001098. This is substantially smaller than the general use point of 0.05. Consequently, the very small number indicates that there is a difference in the data. The Fisher's Exact test yielded a p-value of 0.00000000000004631, signifying a significant difference in the occurrence of Covid-19 in the data. This all shows that the odds a unvaxinated man getting Covid are 2.2 times higher than a man with the vaccine contracting Covid.



```{r}
effect <- maleFisher$p.value/(maleFisher$p.value +1)
effectivenessmale = maleFisher$estimate/(maleFisher$estimate +1)*100
print(effectivenessmale)
```
The dds ratio is 74. 

```{r}
low=(maleFisher$conf.int[1]/(maleFisher$conf.int[1] +1))*100
hi=(maleFisher$conf.int[2]/(maleFisher$conf.int[2] +1))*100
options(digits=2)
```

### Confidence Interval

```{r}
oddsMale = maleFisher$estimate/(maleFisher$estimate+1)*100
print(oddsMale)
maleLow=(maleFisher$conf.int[1]/(maleFisher$conf.int[1]+1))*100
maleHigh=(maleFisher$conf.int[2]/(maleFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for Males: ",maleLow," to ",maleHigh)
```

The confidence interval is >50% with a normal vaccine threshold of >60%. This confidence interval is more than adequate to show that this is a good vaccine for this group.

### Effectiveness Confidence Interval `r low`  to `r hi`

The odds ratio essentially shows how effective the vaccine is. The odds ratio for the males is around 73.8, with an effectiveness confidence interval of low being  68.85-78.32% hi, meaning that the vaccine is effective in protecting males from getting covid-19.


## Females
### Barplot

```{r}
dd2 <- female %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot represents the population of females and their relationship to getting covid-19 by taking either the vaccine or the placebo. The plot shows that around 58% of females who got covid took the placebo. Whereas about 36% of females who got covid took the vaccine.  Therefore, more females who got covid took the placebo. This means that the vaccine seems to be effective for females in this dataset. Although, it seems to be more effective for males than females, since more females than males who contracted covid took the vaccine rather than the placebo.There were two plots that came out. The first plot shows two bars for the treatment, either the placebo or the vaccine. Along the x-axis was the amount of people there was, and along the y-axis shows the infected from covid, either placebo or vaccine. It shows the number of people infected from covid or from the placebo. The second plot also shows two bars for the treatments, either the placebo or the vaccine. It shows the percentage of people infected from covid or from the placebo.

### Numerical Descriptive Results

```{r}
table1 <- xtabs(~infected + treatment, data=female)
rowPerc(table1)
colPerc(table1)
```
The numerical results for the females shows the percentages of females who got covid while taking the vaccine and males who got covid while taking the placebo. It shows that around 65% of the females who got covid took the placebo. Whereas only 35% of females who got covid took the vaccine. This comes to show that the vaccine is effective towards females.

### Inferential Results 

```{r}
chisq.test(table1)
chisqtestGC(table1)
femalesfish <- fisher.test(table1)
femalesfish
```

 A Fisherâ€™s Exact test was run and a p-value was given. The p-value came out to be 1e-08, which is also quite a small p-value. This means that these results are not likely to occur by chance and that there is a statistically significant result.	The odds ratio above came out to be 1.9, meaning that the females that got covid by taking the vaccine were less likely to contract covid than those who took the placebo. The odds of getting covid while taking the vaccine is 2:1.
 
```{r}
effect <- femalesfish$p.value/(femalesfish$p.value +1)
effectivenessfemales = femalesfish$estimate/(femalesfish$estimate +1)*100
print(effectivenessfemales)
```

```{r}
low=(femalesfish$conf.int[1]/(femalesfish$conf.int[1] +1))*100
hi=(femalesfish$conf.int[2]/(femalesfish$conf.int[2] +1))*100
options(digits=2)
```
 
### Effectiveness Confidence Interval `r low`  to `r hi`

Shown above is the effectiveness for the covid-19 vaccine for females. If the effectiveness is above 60%, then the vaccine is shown to be effective. Based on the effectiveness confidence interval of low as 60%-70% hi, I can conclude that the vaccine is effective in protecting females from getting covid-19.The odds ratio essentially shows how effective the vaccine is. The odds ratio for the females is 65 with an effectiveness confidence interval of 59.8 to 69.9%, meaning that the vaccine is effective in protecting females from getting covid-19.


 
## LGBTQ



## Druggies


# Overall Results and Conclusions